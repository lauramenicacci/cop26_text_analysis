---
title: "01_downloading articles"
author: "Laura Menicacci"
date: "28/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages

```{r}
library(tidyverse)
library(rvest)
library(stringr)
library(xml2)
library(quanteda)
```
<br>

## Part 1 - Scraping headlines by date 

what i did until now: 
 - create a list of all guardian pages within the chosen period (18 octr to 28 nov) (RMK:first/last page is with dates also before after 28 nov/18 oct but we can remove them in the cleaning part)
 - try to download pages from list of urls(pages_list) and store them in a dataframe
```{r}
baseurl <- "https://www.theguardian.com/environment/cop26-glasgow-climate-change-conference-2021?page="
pageurl <- paste0(seq(1, 33, 1))
pages_list <- paste0(baseurl, pageurl)
pages_list[1:5] #33 pages until 18 oct = 2 weeks before cop --> I LOOKED AT IT BY HAND, IS THERE A WAY TO LOOK INTO IT AUTOMATICALLY? (NOT URGENT)

#PROBLEM: the urls in the list are characters, so the loop doesn't recognize them. is there a way to make the loop select what's inside the " "? /another way could be download urls in the folder and then extract info from those files 

ourdf <- data.frame()
for (i in 1:length(pages_list))  { if (!file.exists(paste0(ourdf, pages_list[i]))) {
  
  html_nodes('body') %>% 
  xml_find_all('//*[contains(concat( " ", @class, " " ), concat( " ", "fc-date-headline", " " ))] | //*[contains(concat( " ", @class, " " ), concat( " ", "js-headline-text", " " ))]') %>%
  xml_text()
}}


#tryCatch(download.file(pages_list[i], destfile = paste0(ourdf, pages_list[i])))
#      Sys.sleep(runif(1, 2, 7)) 


```
<br>

### code for taking headlines + dates and transforming them in text
```{r}
guardian <- read_html("https://www.theguardian.com/environment/cop26-glasgow-climate-change-conference-2021?page=1")

headlines <- guardian %>% 
  html_nodes('body') %>% 
  xml_find_all('//*[contains(concat( " ", @class, " " ), concat( " ", "fc-date-headline", " " ))] | //*[contains(concat( " ", @class, " " ), concat( " ", "js-headline-text", " " ))]') %>%
  xml_text()

#DATE CLASS //*[contains(concat( " ", @class, " " ), concat( " ", "fc-date-headline", " " ))]

head(headlines, 20)
```


Note that the `echo = FALSE` parameter is added to the code chunk to prevent printing of the R code that generated the plot.
